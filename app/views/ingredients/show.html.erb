<div class="container">
  <div class="ingredient-show-flex">
    <div class="ingredient-show-details">
      <h1> <%= @ingredient.name %> </h1>
      <hr>
      <p> <%= @ingredient.description %> </p>
    </div> 
    <div class="ingredient-ratings-container">
        <div class="card-rating-container-show-flex">
            <% rating = @ingredient.safety_rating %>
            <% if rating != nil %>
                <%= render 'shared/progresscircle', :locals => {"value" => rating} unless rating == nil %>
                <h3>Safety <br> Consensus </h3> 
            <% end %>
        </div>
        <div class="card-rating-container-show-flex">
            <% rating = @ingredient.efficacy_rating %>
            <% if rating != nil %>
                <%= render 'shared/progresscircle', :locals => {"value" => rating} unless rating == nil %>
                <h3>Efficacy <br> Consensus </h3>
            <% end %>                    
        </div>       
    </div>
  </div>
</div>

<!--Product Review Carousel-->
<div class="light-grey-container">
  <div class="container">
    <div class="ingredient-reviews-header">
      <h2>Reviews</h2>
    </div>

    <!--Carousel Wrapper-->
    <div id="multi-item-example" class="carousel slide carousel-multi-item" data-ride="carousel">

      <!--Slides-->
      <div class="carousel-inner" role="listbox">
        <% @ingredient.ingredient_reviews.each_slice(2).with_index do |review_slice, index| %>
          <div class="carousel-item <%= index.zero? ? 'active' : '' %>">
            <div class="row">
              <% review_slice.each do |ingredient_review| %>
                <div class="col-6">
                  <div class="ingredient-review-card">
                    <div class="ingredient-review-header">
                      <%= image_tag "#{ingredient_review.user.photo_url}", class:"avatar-large" %>
                      <div class="ingredient-reviewer-name">
                        <H4><b><%= "#{ingredient_review.user.first_name} #{ingredient_review.user.last_name}"%></b></H2>      
                      </div>
                    </div>
                    <div class="ingredient-review-body">
                      <h4> <%= ingredient_review.title %> </h3>
                      <p> <%= ingredient_review.content %> </p>
                      <p> <%= ingredient_review.supporting_evidence %> </p>
                    </div>
                    <div class="ingredient-review-ratings">
                      <div class="card-rating-container-flex">          
                          <% rating = ingredient_review.safety_rating %>
                          <% if rating != nil %>
                              <%= render 'shared/progresscircle', :locals => {"value" => rating} unless rating == nil %>
                              <p>Safety</p> 
                          <% end %>
                      </div>
                      <div class="card-rating-container-flex">
                          <% rating = ingredient_review.efficacy_rating %>
                          <% if rating != nil %>
                              <%= render 'shared/progresscircle', :locals => {"value" => rating} unless rating == nil %>
                              <p>Efficacy</p>
                          <% end %>                    
                      </div>          
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>  
      </div>
      <!--/.Slides-->
      <div class="d-flex py-5">
         <a class="btn-floating" href="#multi-item-example" data-slide="prev"><i class="fa fa-chevron-left"></i></a>
         <ol class="carousel-indicators flex-grow-1"> 
          <% ((@ingredient.ingredient_reviews.size / 2) + 1).times do |index|  %>
            <li data-target="#multi-item-example" data-slide-to="<%=index%>" class="<%= index.zero? ? 'active' : '' %>"></li>
          <% end %>
        </ol>
        <a class="btn-floating" href="#multi-item-example" data-slide="next"><i class="fa fa-chevron-right"></i></a>    
      </div>
    </div>
    <!--/.Carousel Wrapper-->
    <div class="container" style="margin-top: 20px">
      <%= link_to "Write a review", products_path, class: "btn-ghost" %>
    </div>
  </div>
</div>

<!-- Alternative ProductsCarousel Wrapper-->
<div class="dark-blue-container">
  <div class="container">
    <div class="ingredient-reviews-header">
      <h2>Reviews</h2>
    </div>

    <!--Carousel Wrapper-->
    <div id="multi-item-example" class="carousel slide carousel-multi-item" data-ride="carousel">

      <!--Slides-->
      <div class="carousel-inner" role="listbox">
        <% @ingredient.products.each_slice(3).with_index do |product_slice, index| %>
          <div class="carousel-item <%= index.zero? ? 'active' : '' %>">
            <div class="product-grid">
              <%= render product_slice %>
            </div>
          </div>
        <% end %>  
      </div>
      <!--/.Slides-->
      <div class="d-flex py-5">
         <a class="btn-floating" href="#multi-item-example" data-slide="prev"><i class="fa fa-chevron-left"></i></a>
         <ol class="carousel-indicators flex-grow-1"> 
          <% ((@ingredient.ingredient_reviews.size / 2) + 1).times do |index|  %>
            <li data-target="#multi-item-example" data-slide-to="<%=index%>" class="<%= index.zero? ? 'active' : '' %>"></li>
          <% end %>
        </ol>
        <a class="btn-floating" href="#multi-item-example" data-slide="next"><i class="fa fa-chevron-right"></i></a>    
      </div>
    </div>
    <!--/.Carousel Wrapper-->
  </div>
</div>

<div class="container" style="padding-top: 20px, padding-bottom: 30px">
  <h2>Popular Resources</h2>
  <ul style="text-align: left">
    <li>link 1</li>
    <li>link 1</li>
    <li>link 1</li>
    <li>link 1</li>
  </ul>
</div>


<% if current_user %>
  <% if current_user.verified  %>
    <div class="container">
      <%= render partial: 'ingredient_reviews/form' %>
    </div>
  <% end %>
<% end %>




